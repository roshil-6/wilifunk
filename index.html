<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WILIFUNK SPACE ROCKET</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="game-container">
        <!-- Game Canvas -->
        <div id="phaser-game"></div>

        <!-- In-Game UI -->
        <div id="gameUI" class="hidden">
            <button id="pauseBtn" class="game-btn pause-btn" title="Menu">‚ò∞</button>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOverOverlay" class="overlay hidden">
            <div class="overlay-content">
                <div class="overlay-title game-over-title">CRASHED!</div>
                <div class="overlay-message" id="gameOverMessage">Your rocket couldn't make it...</div>
                <div class="overlay-stats" id="gameOverStats"></div>

                <div class="overlay-buttons">
                    <button id="restartBtn" class="menu-button primary">LAUNCH AGAIN</button>
                    <button id="homeBtn" class="menu-button secondary">MENU</button>
                </div>
            </div>
        </div>

        <!-- Home Menu -->
        <div id="homeMenu" class="home-menu">
            <div class="home-content">
                <!-- Title Section -->
                <div class="title-section">
                    <div class="rocket-icon">üöÄ</div>
                    <h1 class="game-title">WILIFUNK SPACE ROCKET</h1>

                    <p class="tagline"><span id="taglineText">How far can you fly?</span></p>
                    <p class="challenge-text">Average pilots crash within 10 obstacles.</p>

                    <!-- Intensity Slider -->
                    <div class="intensity-control" style="margin-top: 30px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: #888; font-size: 14px; letter-spacing: 2px;">INTENSITY</span>
                            <span id="intensityValue"
                                style="color: #00d4ff; font-weight: bold; font-size: 18px;">25</span>
                        </div>
                        <input type="range" id="intensitySlider" min="10" max="50" value="25" class="intensity-slider">
                        <div id="intensityTagline" class="intensity-feedback">Steady as she goes.</div>
                    </div>

                    <div class="action-buttons"
                        style="display: flex; gap: 10px; justify-content: center; margin-top: 10px;">
                        <button id="mainStartBtn" class="start-button">üöÄ LAUNCH</button>
                    </div>
                </div>

                <!-- Rules Section -->
                <div class="rules-section">
                    <h2 class="rules-title">CONTROLS</h2>
                    <div class="rules-simple">
                        <div class="rule-big">
                            <span class="key-icon">TAP</span>
                            <span class="or-text">or</span>
                            <span class="key-icon">SPACE</span>
                        </div>
                        <p class="rule-desc">to thrust upward</p>
                    </div>
                    <div class="rules-tips">
                        <p>‚ö†Ô∏è Avoid the barriers</p>
                        <p>‚≠ê Collect 3 Stars = üõ°Ô∏è Shield (5s)</p>
                        <p>üï≥Ô∏è Black Holes = ESCAPE or DIE</p>
                        <p>üèÜ Beat your high score</p>
                    </div>
                </div>

                <!-- Trophy Case -->
                <div class="trophy-section">
                    <h2 class="rules-title">TROPHY CASE</h2>
                    <div id="badgeContainer" class="badge-grid">
                        <p class="no-badges">No badges yet...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <script src="game.js"></script>
    <script>
        // Menu Navigation
        const homeMenu = document.getElementById('homeMenu');
        const gameUI = document.getElementById('gameUI');
        const gameOverOverlay = document.getElementById('gameOverOverlay');

        // Start Game Flow
        const triggerStartFlow = () => {
            console.log("Launching game...");
            launchGame();
        };

        document.getElementById('mainStartBtn')?.addEventListener('click', triggerStartFlow);

        function launchGame() {
            if (homeMenu) homeMenu.classList.add('hidden');
            if (gameUI) gameUI.classList.remove('hidden');
        }

        // Pause/Menu button
        document.getElementById('pauseBtn').addEventListener('click', () => {
            showHomeMenu();
        });

        // Intensity Handling
        const intensitySlider = document.getElementById('intensitySlider');
        const intensityValue = document.getElementById('intensityValue');
        const intensityTagline = document.getElementById('intensityTagline');

        // Load saved intensity
        const savedIntensity = localStorage.getItem('spaceRocketIntensity') || '25';
        intensitySlider.value = savedIntensity;
        intensityValue.textContent = savedIntensity;

        intensitySlider.addEventListener('input', (e) => {
            const val = e.target.value;
            intensityValue.textContent = val;
            localStorage.setItem('spaceRocketIntensity', val);
            updateIntensityFeedback(val);
        });

        function updateIntensityFeedback(val) {
            let feedback = "";
            let color = "#00d4ff";

            if (val <= 20) {
                const teases = [
                    "Too scared of the void?",
                    "Grandma mode activated.",
                    "Safe and boring, huh?",
                    "Training wheels on."
                ];
                feedback = teases[Math.floor(val / 5) % teases.length];
                color = "#ffdd59";
            } else if (val < 40) {
                feedback = "Steady as she goes.";
                color = "#00d4ff";
            } else {
                const apprec = [
                    "NOW WE'RE TALKING!",
                    "Absolute orbital madness.",
                    "You've got titanium nerves!",
                    "GLORY OR DEATH!"
                ];
                feedback = apprec[Math.floor((val - 40) / 3) % apprec.length];
                color = "#ff3366";
            }

            intensityTagline.textContent = feedback;
            intensityTagline.style.color = color;
            intensityValue.style.color = color;

            // Pulse effect
            intensityValue.style.transition = "none";
            intensityValue.style.transform = "scale(1.3)";
            setTimeout(() => {
                intensityValue.style.transition = "transform 0.2s ease";
                intensityValue.style.transform = "scale(1)";
            }, 50);
        }

        // Init feedback
        updateIntensityFeedback(savedIntensity);

        // Restart button
        document.getElementById('restartBtn')?.addEventListener('click', () => {
            gameOverOverlay.classList.add('hidden');
            if (typeof restartGame === 'function' && typeof sceneRef !== 'undefined') {
                restartGame(sceneRef);
            }
        });

        // Home button
        document.getElementById('homeBtn')?.addEventListener('click', showHomeMenu);

        function showHomeMenu() {
            homeMenu.classList.remove('hidden');
            gameUI.classList.add('hidden');
            gameOverOverlay.classList.add('hidden');

            if (typeof updateTagline === 'function') {
                updateTagline();
            }

            if (typeof restartGame === 'function' && typeof sceneRef !== 'undefined') {
                restartGame(sceneRef);
            }
        }

        // Expose function for game.js
        window.showGameOver = function (score, highScore) {
            gameOverOverlay.classList.remove('hidden');
            const isNewRecord = score >= highScore && score > 0;
            document.getElementById('gameOverMessage').textContent =
                isNewRecord ? 'üéâ NEW HIGH SCORE!' : 'Your rocket crashed...';
            document.getElementById('gameOverStats').innerHTML =
                `Score: <strong>${score}</strong> | Best: <strong>${highScore}</strong>`;
        };

        // Dynamic Tagline based on High Score
        function updateTagline() {
            const score = parseInt(localStorage.getItem('spaceRocketHighScore') || '0');
            const tagElement = document.getElementById('taglineText');

            let text = "";

            if (score < 20) {
                text = "Your high score is a joke in 3 galaxies.";
            } else if (score < 50) {
                text = "Double digits? Someone's trying hard.";
            } else if (score < 100) {
                text = "Not terrible. But my cat could do better.";
            } else if (score < 200) {
                text = "Finally, a pilot who knows up from down.";
            } else if (score < 500) {
                text = "Okay, you're actually dangerous now.";
            } else {
                text = "The Universe touches its hat to you.";
            }

            tagElement.textContent = text;
            tagElement.style.opacity = 1;
        }

        // Run on load
        updateTagline();

        // Listen for updates from game
        window.updateBadgesUI = function () {
            updateTagline();
        };
    </script>
</body>

</html>